// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Kalvium Assignment Basic Models
model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  createdAt DateTime @default(now())
  
  // Relationships
  projects Project[]
  
  @@map("users")
}

model Project {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())
  
  // Foreign Key
  userId Int
  
  // Relationships
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  tasks Task[]
  
  @@map("projects")
}

model Task {
  id          Int      @id @default(autoincrement())
  title       String
  status      String   @default("pending")
  createdAt   DateTime @default(now())
  
  // Foreign Key
  projectId Int
  
  // Relationships
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  @@map("tasks")
}

// TrueTrip Extended Models
model TripUser {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  username  String   @unique
  password  String
  firstName String
  lastName  String
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  trips     Trip[]
  bookings  Booking[]
  reviews   Review[]
  
  @@map("trip_users")
}

model Trip {
  id          Int       @id @default(autoincrement())
  title       String
  description String
  destination String
  startDate   DateTime
  endDate     DateTime
  price       Float
  maxPeople   Int
  images      String[]
  isPublished Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  userId Int
  
  user     TripUser   @relation(fields: [userId], references: [id], onDelete: Cascade)
  bookings Booking[]
  reviews  Review[]
  categories TripCategory[]
  
  @@index([destination])
  @@index([startDate])
  @@index([isPublished])
  @@map("trips")
}

model Booking {
  id          Int         @id @default(autoincrement())
  status      BookingStatus @default(PENDING)
  totalAmount Float
  peopleCount Int
  specialRequests String?
  bookedAt    DateTime    @default(now())
  
  userId Int
  tripId Int
  
  user TripUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  trip Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade)
  
  @@map("bookings")
}

model Review {
  id        Int     @id @default(autoincrement())
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  
  userId Int
  tripId Int
  
  user TripUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  trip Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade)
  
  @@unique([userId, tripId])
  @@map("reviews")
}

model Category {
  id          Int    @id @default(autoincrement())
  name        String @unique
  description String?
  
  trips TripCategory[]
  
  @@map("categories")
}

model TripCategory {
  id         Int @id @default(autoincrement())
  tripId     Int
  categoryId Int
  
  trip     Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade)
  category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  
  @@unique([tripId, categoryId])
  @@map("trip_categories")
}`

enum UserRole {
  USER
  ADMIN
  GUIDE
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}


model Bus {
  id          String     @id @default(uuid())
  busNumber   String
  operator    String
  totalSeats  Int
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  routes      BusRoute[]
}

model BusRoute {
  id            String     @id @default(uuid())
  busId         String
  fromCity      String
  toCity        String
  departureTime DateTime
  arrivalTime   DateTime
  price         Float
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  bus           Bus        @relation(fields: [busId], references: [id], onDelete: Cascade)
  tickets       BusTicket[]
}

model BusTicket {
  id          String     @id @default(uuid())
  seatNumber  Int
  status      TicketStatus @default(BOOKED)
  bookedAt    DateTime   @default(now())

  userId      Int
  routeId     String

  // Relations
  user  TripUser  @relation(fields: [userId], references: [id], onDelete: Cascade)
  route BusRoute  @relation(fields: [routeId], references: [id], onDelete: Cascade)
}

enum TicketStatus {
  BOOKED
  CANCELLED
  REFUNDED
}